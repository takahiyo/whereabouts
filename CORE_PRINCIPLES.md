# AIコーディング基本原則

本ドキュメントは、AIによるコーディング作業において**常に遵守すべき基本原則**を定める。
すべての開発作業の開始時に本ドキュメントを読み込み、作業中も常に意識すること。

---

## 絶対遵守事項

以下の規則は**いかなる場合も違反してはならない**。

### 1. SSOT（Single Source of Truth）の厳守

**あなたは設定値・定数・識別子をコード内に直接記述してはならない。**

- 定数は専用ファイル（`constants/` 等）に集約しなければならない
- 同じ値が2箇所以上に存在してはならない
- 既存の定数定義を確認せずに新しい値を追加してはならない

**違反時の影響**: 値の変更時に修正漏れが発生し、動作不整合やバグの原因となる

### 2. 既存構造の保護

**あなたは既存のモジュール構造・初期化順序・依存関係を破壊してはならない。**

- 新規コードは既存のパターンに従って追加しなければならない
- 依存注入（`init(config)`等）のパターンが存在する場合、それを維持しなければならない
- ファイルの読み込み順序に依存する処理を変更してはならない

**違反時の影響**: 初期化エラー、未定義参照、機能の完全な破壊

### 3. コメントによる意図の明示

**あなたはコメントなしでコードを追加・変更してはならない。**

- 新規関数には目的・引数・戻り値を記述しなければならない
- 複雑なロジックには「なぜそうするのか」を記述しなければならない
- 既存コメントと矛盾する変更を行う場合、コメントも更新しなければならない

**違反時の影響**: 後続の修正で意図が伝わらず、誤った変更が行われる

### 4. 変更前の確認義務

**あなたはコードを変更する前に、その影響範囲を確認しなければならない。**

- 変更対象が他のファイルから参照されているか確認すること
- 関数のシグネチャを変更する場合、すべての呼び出し元を確認すること
- 定数やクラス名を変更する場合、全ファイルを検索すること

**違反時の影響**: 参照切れ、未定義エラー、予期しない動作

---

## 作業開始時の必須手順

新しい作業を開始する前に、以下を必ず実行すること。

### 1. プロジェクト構造の把握

```bash
# ディレクトリ構成を確認
ls -la
ls -la src/ assets/ # 等、主要ディレクトリ

# ドキュメントを確認
cat README.md
cat docs/ai-coding/*.md  # 本ガイドライン群
```

### 2. 既存パターンの確認

- 定数管理の方式（`constants/` の構成）
- モジュールの初期化パターン（`init()` の有無）
- コメントの書式（JSDoc、セクション区切り等）

### 3. 関連ガイドラインの参照

作業内容に応じて、以下の詳細ガイドを参照すること。

| 作業内容 | 参照ドキュメント |
|----------|------------------|
| 定数・設定値の追加 | [SSOT_GUIDE.md](./SSOT_GUIDE.md) |
| 新機能の追加 | [MODULE_GUIDE.md](./MODULE_GUIDE.md) |
| コメント・ドキュメント | [COMMENT_GUIDE.md](./COMMENT_GUIDE.md) |
| コード分割・リファクタリング | [REFACTOR_GUIDE.md](./REFACTOR_GUIDE.md) |

---

## 禁止事項チェックリスト

作業完了時に以下を確認すること。

- [ ] マジックナンバー・ハードコーディングを追加していないか
- [ ] 既存の定数を参照せず、同じ値を新規に書いていないか
- [ ] 関数・変数の目的を示すコメントを書いたか
- [ ] 既存の初期化順序・依存関係を壊していないか
- [ ] 変更した箇所の参照元をすべて確認したか

---

## 例外の取り扱い

原則に従えない正当な理由がある場合：

1. **理由をコメントで明記**すること
2. **将来の修正方針**を記述すること
3. ユーザーに**例外である旨を報告**すること

```javascript
// TODO: 暫定的なハードコーディング
// 理由: APIの仕様確定待ち
// 方針: 仕様確定後にconstants/api.jsへ移動
const TEMP_ENDPOINT = "https://example.com/api";
```

---

## 本原則の位置づけ

- 本ドキュメントは**最上位の規則**である
- 他のガイドラインと矛盾する場合、本原則が優先される
- 不明点がある場合は、作業前にユーザーに確認すること
